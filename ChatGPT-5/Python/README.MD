# Poetica â€” Tiny Weighted Grammar Expander

> **KR/EN Bilingual README** Â· **Python 3.11+**, **Single file**, **Stdlibâ€‘only**, **Deterministic by seed**

---

## ëª©ì°¨ (Table of Contents)

1. ê°œìš” (Overview)
2. íŠ¹ì§• (Features)
3. ë¹ ë¥¸ ì‹œì‘ (Quickstart)
4. ì‚¬ìš©ë²• (CLI Usage)
5. ì˜ˆì‹œ (Examples)
6. ë¬¸ë²• DSL ì„¤ëª… (Grammar DSL)
7. JSON ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (JSON Output Schema)
8. ê²°ì •ì„± & ë‚œìˆ˜ (Determinism)
9. ì„±ëŠ¥ & íŠœë‹ (Performance & Tuning)
10. í…ŒìŠ¤íŠ¸ (Testing)
11. ì„¤ê³„ ë…¸íŠ¸ (Design Notes)
12. ë¬¸ì œ í•´ê²° (Troubleshooting)
13. ì„ë² ë”© ê°€ì´ë“œ (Embedding as a Library)
14. ë³´ì•ˆ ë° ì œì•½ (Security & Limitations)
15. FAQ
16. ë¼ì´ì„ ìŠ¤ (License)

---

## ê°œìš” (Overview)

**Poetica**ëŠ” ê°€ë²¼ìš´ **ê°€ì¤‘ì¹˜ ê¸°ë°˜ ë¬¸ë²•(DSL)** ë¡œë¶€í„° í…ìŠ¤íŠ¸ë¥¼ **ê²°ì •ì (ì¬í˜„ ê°€ëŠ¥)** ìœ¼ë¡œ ìƒì„±í•˜ëŠ”, ë‹¨ì¼ íŒŒì¼ íŒŒì´ì¬ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ì¢Œì¸¡ì—ì„œë¶€í„° ë¹„ë‹¨ë§ ê¸°í˜¸ë¥¼ í™•ì¥í•˜ëŠ” **ê°€ì¤‘ ì¢Œì¸¡ìµœëŒ€ íŒŒìƒ(Leftmost Derivation)** ì„ ì‚¬ìš©í•˜ë©°, ê²°ê³¼ë¥¼ **í…ìŠ¤íŠ¸** ë˜ëŠ” **JSON íŒŒìƒ íŠ¸ë¦¬**ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤. ì½”ë“œëŠ” ì˜ì¡´ì„± ì—†ì´ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬(`argparse`, `dataclasses`, `shlex`, `random`, `json`)ë§Œ ì‚¬ìš©í•˜ê³ , ì½ê¸° ì‰¬ìš´ êµ¬ì¡°ì™€ ì‹¤ìš©ì  ê¸°ëŠ¥ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.

PoeticaëŠ” **í”„ë¡¬í”„íŠ¸/ì¹´í”¼/ê²Œì„ í…ìŠ¤íŠ¸** ì œì‘, **í…ŒìŠ¤íŠ¸ ë°ì´í„°** ìƒì„±, **í…œí”Œë¦¿ ë¬¸ì¥ ë‹¤ì–‘í™”**, **í•™ìŠµìš© ë¬¸ë²• ì‹¤í—˜** ë“± ë‹¤ì–‘í•œ ëª©ì ì— ì í•©í•©ë‹ˆë‹¤. ëª¨ë“  ì‹¤í–‰ì€ ì‹œë“œ ê¸°ë°˜ìœ¼ë¡œ ì¬í˜„ ê°€ëŠ¥í•˜ë©°, ì¢Œì¬ê·€ ë˜ëŠ” í­ì£¼ ì„±ì¥ì— ëŒ€ë¹„í•´ **ëª…ì‹œì  ì•ˆì „ í•œê³„**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## íŠ¹ì§• (Features)

* ğŸ§¾ **ë¯¸ë‹ˆ DSL**: `LHS -> alt1 | alt2 *3` êµ¬ë¬¸. ëŒ€ì•ˆ ëì˜ `*k`ë¡œ ê°€ì¤‘ì¹˜.
* ğŸŒ± **ê²°ì •ì  ì‹¤í–‰**: `--seed` ì§€ì • ì‹œ ë™ì¼ ì…ë ¥ì€ ë™ì¼ ê²°ê³¼.
* ğŸŒ³ **íŒŒìƒ íŠ¸ë¦¬ JSON**: `--format json`ìœ¼ë¡œ ì „ì²´ íŠ¸ë¦¬ í™•ì¸ ê°€ëŠ¥.
* ğŸ§° **ë‹¨ì¼ íŒŒì¼Â·ë¬´ì˜ì¡´ì„±**: ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì‹¤í–‰.
* ğŸ§ª **ìì²´ í…ŒìŠ¤íŠ¸ í¬í•¨**: `python main.py --test`ë¡œ 2ì´ˆ ë‚´ ê²€ì¦.
* ğŸ§¯ **ì•ˆì „ì¥ì¹˜**: `--max-steps`, `--max-tokens`ë¡œ ë¬´í•œì„±ì¥ ë°©ì§€.
* ğŸ§  **ë¬¸ì¥ ë¯¸ë ¤í™”**: `smart_join()` ìœ¼ë¡œ êµ¬ë‘ì  ì• ê³µë°± ì œê±° ë° `'s` ê²°í•©.
* ğŸ§© **ê²¬ê³ í•œ í† í¬ë‚˜ì´ì§•**: `shlex`ë¡œ ê³µë°± í¬í•¨ ë‹¨ë§(ì˜ˆ: "New York") ì²˜ë¦¬.
* ğŸ§­ **ëª…í™•í•œ ì˜¤ë¥˜**: `GrammarError`, `GenerationLimitError` ë¡œ ë„ë©”ì¸ ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€.

---

## ë¹ ë¥¸ ì‹œì‘ (Quickstart)

```bash
python main.py --help
python main.py --seed 1 --format text
```

> ê¸°ë³¸ ì‹¤í–‰ì€ ë‚´ì¥ ì˜ˆì‹œ ë¬¸ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§Œì•½ `Undefined nonterminals: Name` ê°™ì€ ì˜¤ë¥˜ê°€ ë³´ì´ë©´ ì‚¬ìš©ì ì •ì˜ ë¬¸ë²•ì„ `--grammar` ë¡œ ë„˜ê¸°ê±°ë‚˜, ë¬¸ë²•ì— `Name` ê·œì¹™ì„ ì¶”ê°€í•˜ì„¸ìš”. ì•„ë˜ **ê¶Œì¥ ì˜ˆì‹œ ë¬¸ë²•**ì„ ì‚¬ìš©í•˜ë©´ ì•ˆì „í•©ë‹ˆë‹¤.

### ê¶Œì¥ ì˜ˆì‹œ ë¬¸ë²• (Recommended grammar)

**Bash/Zsh** (ë©€í‹°ë¼ì¸ í™˜ê²½ë³€ìˆ˜):

```bash
read -r -d '' G <<'GRAM'
S  -> NP VP . | Name VP . *2
NP -> Det N   | Det Adj N    | Name
VP -> V NP    | V Adv        | V
Det -> the | a
N   -> fox | dog | code | idea
Adj -> quick | elegant | careful
V   -> jumps | writes | tests | flows
Adv -> swiftly | beautifully | precisely
Name -> Alice | Bob | "Ada Lovelace"
. -> .
GRAM
python main.py --grammar "$G" --seed 7
```

**PowerShell**:

```powershell
$G = @"
S  -> NP VP . | Name VP . *2
NP -> Det N   | Det Adj N    | Name
VP -> V NP    | V Adv        | V
Det -> the | a
N   -> fox | dog | code | idea
Adj -> quick | elegant | careful
V   -> jumps | writes | tests | flows
Adv -> swiftly | beautifully | precisely
Name -> Alice | Bob | "Ada Lovelace"
. -> .
"@
python .\main.py --grammar "$G" --seed 7
```

---

## ì‚¬ìš©ë²• (CLI Usage)

```bash
python main.py [--seed SEED] [--start SYMBOL]
               [--max-steps N] [--max-tokens N]
               [--format {text,json}] [--verbose]
               [--grammar "<grammar text>"]
               [--test]
```

* `--seed`: ê²°ì •ì  ìƒì„± ì‹œë“œ (ê¸°ë³¸: 1)
* `--start`: ì‹œì‘ ì‹¬ë³¼ (ê¸°ë³¸: `S`)
* `--format`: `text` ë˜ëŠ” `json`
* `--verbose`: íŒŒìƒ ê³¼ì •ì„ ë¡œê·¸ë¡œ ì¶œë ¥
* `--grammar`: ì¸ë¼ì¸ ë¬¸ë²• í…ìŠ¤íŠ¸ (ë¯¸ì œê³µ ì‹œ ë‚´ì¥ ë¬¸ë²• ì‹œë„)
* `--max-steps`, `--max-tokens`: ì•ˆì „ ì œí•œì¹˜
* `--test`: doctest + unittest ì‹¤í–‰ í›„ ì¢…ë£Œ

---

## ì˜ˆì‹œ (Examples)

```bash
# 1) í…ìŠ¤íŠ¸ ì¶œë ¥ (ê²°ì •ì )
python main.py --grammar "$G" --seed 1

# 2) íŒŒìƒ íŠ¸ë¦¬ JSON ì „ì²´ ë³´ê¸°
python main.py --grammar "$G" --format json

# 3) íŒŒìƒ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ (jq ì‚¬ìš©)
python main.py --grammar "$G" --format json | jq -r .text

# 4) í™•ì¥ ë¡œê·¸ ë³´ê¸°
python main.py --grammar "$G" --verbose

# 5) ì‹œì‘ ì‹¬ë³¼ ë³€ê²½
python main.py --grammar "$G" --start NP --seed 3

# 6) ì•ˆì „ í•œê³„ ì¡°ì •
python main.py --grammar "$G" --max-steps 200 --max-tokens 400

# 7) í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python main.py --test
```

ìƒ˜í”Œ ì¶œë ¥ (ì˜ˆì‹œ):

```
the elegant code flows.
```

---

## ë¬¸ë²• DSL ì„¤ëª… (Grammar DSL)

* **ê·œì¹™ í˜•ì‹**: `LHS -> alt1 | alt2 | ...`
* **ë¹„ë‹¨ë§(Nonterminal)**: `UpperCamelCase` í† í° (`S`, `NP`, `Det` ë“±)
* **ë‹¨ë§(Terminal)**: ê·¸ ì™¸ í† í°. ê³µë°± í¬í•¨ í† í°ì€ `"..."`ë¡œ ê°ì‹¸ê¸° (ì˜ˆ: `"New York"`).
* **ê°€ì¤‘ì¹˜(Weight)**: ëŒ€ì•ˆ ëì— `*k` (ì •ìˆ˜, k â‰¥ 1). ì˜ˆ: `VP -> V NP *2 | V` ëŠ” ì²« ëŒ€ì•ˆì„ ë‘ ë°°ë¡œ ì„ í˜¸.
* **ì£¼ì„**: `#` ë¡œ ì‹œì‘í•˜ëŠ” ì¤„ì€ ë¬´ì‹œë©ë‹ˆë‹¤.
* **êµ¬ë‘ì **: `, . ; : ! ?` ê°™ì€ í† í°ì€ ì¶œë ¥ ì‹œ ì• ê³µë°± ì—†ì´ ë¶™ìŠµë‹ˆë‹¤. `'s` ëŠ” ì§ì „ ë‹¨ì–´ì™€ ê²°í•©ë©ë‹ˆë‹¤.
* **ì •ì˜ ìš”ê±´**: ì‚¬ìš©ëœ ëª¨ë“  ë¹„ë‹¨ë§ì€ ìµœì†Œ í•œ ë²ˆ ì´ìƒ **ì •ì˜** ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë¯¸ì •ì˜ ì‹œ `GrammarError`.

### ì¸ìš©ê³¼ ì´ìŠ¤ì¼€ì´í”„ (Quoting & Escapes)

* ê³µë°±/íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ë‹¨ë§ì€ ë°˜ë“œì‹œ `"..."`ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
* ë”°ì˜´í‘œ ë‚´ë¶€ì˜ ë”°ì˜´í‘œëŠ” í‘œì¤€ `shlex` ê·œì¹™ì— ë”°ë¦…ë‹ˆë‹¤. ì˜ˆ: `"\"quoted\" word"`.

### ì¢Œì¬ê·€ íšŒí”¼ íŒ (Avoiding Left Recursion)

ì¢Œì¬ê·€ëŠ” í­ì£¼ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:

```
Bad:  Expr -> Expr "+" Term | Term
Good: Expr -> Term ExprTail
      ExprTail -> "+" Term ExprTail | Îµ   # ÎµëŠ” ë¹ˆ ëŒ€ì•ˆì„ ì˜ë¯¸(ë¬¸ë²•ìƒ ì§ì ‘ í‘œê¸° ê¸ˆì§€)
```

> PoeticaëŠ” ë¹ˆ ë¬¸ìì—´(Îµ)ì„ ì§ì ‘ í‘œê¸°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëŒ€ì‹  `Optional` ê°™ì€ ë¹„ë‹¨ë§ì„ ë§Œë“¤ì–´ `Optional -> nothing | something` í˜•íƒœë¡œ ìš°íšŒí•˜ì„¸ìš”.

---

## JSON ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (JSON Output Schema)

```json
{
  "text": "the elegant code flows.",
  "tree": {
    "label": "S",
    "children": [
      { "label": "NP", "children": [
        { "label": "Det", "children": [{"terminal": "the"}] },
        { "label": "Adj", "children": [{"terminal": "elegant"}] },
        { "label": "N",   "children": [{"terminal": "code"}] }
      ]},
      { "label": "VP", "children": [
        { "label": "V", "children": [{"terminal": "flows"}] }
      ]},
      { "terminal": "." }
    ]
  }
}
```

* ê° ë…¸ë“œëŠ” `{ "label": <ë¹„ë‹¨ë§ëª…>, "children": [...] }` í˜•íƒœì…ë‹ˆë‹¤.
* ë‹¨ë§ í† í°ì€ `{ "terminal": <ë¬¸ìì—´> }` ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
* `text` í•„ë“œëŠ” `smart_join()` ê·œì¹™ì´ ì ìš©ëœ ìµœì¢… ê²°ê³¼ ë¬¸ìì—´ì…ë‹ˆë‹¤.

---

## ê²°ì •ì„± & ë‚œìˆ˜ (Determinism)

* ë‚œìˆ˜ëŠ” `random.Random(seed)` ê¸°ë°˜ì˜ **ì •ìˆ˜ ê°€ì¤‘ ì„ íƒ**ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ **ë¶€ë™ì†Œìˆ˜ ì˜¤ì°¨**ì˜ ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.
* ë™ì¼í•œ **ë¬¸ë²•/ì‹œë“œ/íŒŒë¼ë¯¸í„°** ì¡°í•©ì€ OS/í™˜ê²½ì— ìƒê´€ì—†ì´ **í•­ìƒ ë™ì¼í•œ ê²°ê³¼**ë¥¼ ë§Œë“­ë‹ˆë‹¤.
* ìƒˆë¡œìš´ ë³€ì£¼ê°€ í•„ìš”í•˜ë©´ **ì‹œë“œë§Œ ë³€ê²½**í•˜ì„¸ìš”.

---

## ì„±ëŠ¥ & íŠœë‹ (Performance & Tuning)

* **ë³µì¡ë„**: `m`=í™•ì¥ ë‹¨ê³„ ìˆ˜, `k`=í‰ê·  ëŒ€ì•ˆ ìˆ˜ì¼ ë•Œ ì‹œê°„ `O(m * k)` / ë©”ëª¨ë¦¬ `O(total_symbols)`.
* **íŠœë‹ í¬ì¸íŠ¸**:

  * ê¸´ ë¬¸ì¥ì„ ì›í•˜ë©´ `--max-steps`, `--max-tokens` ê°’ì„ ëŠ˜ë¦¬ì„¸ìš”.
  * ë§¤ìš° ê°€ì§€ê°€ ë§ì€ ë¬¸ë²•ì€ ê°€ì¤‘ì¹˜ë¡œ í™•ì¥ì„ ìœ ë„í•´ í‰ê·  ë¶„ê¸°ìˆ˜ë¥¼ ë‚®ì¶”ì„¸ìš”.
  * ì¢Œì¬ê·€/ìˆœí™˜ì€ ê°€ê¸‰ì  ì œê±°í•˜ê±°ë‚˜ ì¬ê·€ ê¹Šì´ë¥¼ ì–•ê²Œ ë§Œë“œëŠ” êµ¬ì¡°ë¡œ ë°”ê¾¸ì„¸ìš”.
* ê¸°ë³¸ ì…ë ¥ í¬ê¸°ì—ì„œ **< 1ì´ˆ** ì‹¤í–‰ì„ ëª©í‘œë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## í…ŒìŠ¤íŠ¸ (Testing)

```bash
python main.py --test
```

* **Doctest**: ì‘ì€ ì‚¬ìš© ì˜ˆë¥¼ ë¬¸ì„œí™”í•˜ë©° ë™ì‹œ ê²€ì¦í•©ë‹ˆë‹¤.
* **Unittest**: ì •ìƒ ìƒì„±, ë¯¸ì •ì˜ ì‹¬ë³¼ ì˜¤ë¥˜, ì œí•œì¹˜ ê°ì§€ ë“± **ëŒ€í‘œ ì‹œë‚˜ë¦¬ì˜¤ 3ê°€ì§€ ì´ìƒ**ì„ ê²€ì¦í•©ë‹ˆë‹¤.
* í…ŒìŠ¤íŠ¸ëŠ” 2ì´ˆ ë‚´ ì™„ë£Œë˜ë„ë¡ êµ¬ì„±ë˜ì–´ CIì—ë„ ì í•©í•©ë‹ˆë‹¤.

---

## ì„¤ê³„ ë…¸íŠ¸ (Design Notes)

* **ì¢Œì¸¡ ìµœëŒ€ íŒŒìƒ + ê°€ì¤‘ ì„ íƒ**: ì¶”ì  ê°€ëŠ¥í•œ ì „ê°œ ìˆœì„œ ë³´ì¥.
* **ì •ìˆ˜ ê¸°ë°˜ ê°€ì¤‘ ì„ íƒ**: ë¶€ë™ì†Œìˆ˜ì  ëˆ„ì  ì˜¤ì°¨ íšŒí”¼.
* **ë°ì´í„° í´ë˜ìŠ¤**: `Rule/Production` ì€ ë¶ˆë³€, `Node` ëŠ” íŠ¸ë¦¬ ì¡°ë¦½ì„ ìœ„í•´ ìµœì†Œ ê°€ë³€.
* **`shlex` í† í¬ë‚˜ì´ì €**: ì¸ìš©ëœ ë‹¨ë§ê³¼ ì‰˜ ì¹œí™”ì  ì…ë ¥ì„ ì•ˆì „ íŒŒì‹±.
* **ì¶œë ¥ ë¯¸ë ¤í™”**: `smart_join()` ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ì›€ í™•ë³´ (êµ¬ë‘ì /ì†Œìœ ê²© ì²˜ë¦¬).
* **ëª…í™•í•œ ê³„ì¸µ**: ìƒìˆ˜ â†’ íƒ€ì… â†’ í•µì‹¬ ë¡œì§ â†’ CLI â†’ í…ŒìŠ¤íŠ¸ì˜ ì¼ê´€ëœ íŒŒì¼ íë¦„.

---

## ë¬¸ì œ í•´ê²° (Troubleshooting)

* **`Undefined nonterminals: X`**: ë¬¸ë²•ì—ì„œ ì‚¬ìš©í•œ ëª¨ë“  ë¹„ë‹¨ë§ì„ ì •ì˜í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
* **Windows PowerShellì—ì„œ ë”°ì˜´í‘œ ë¬¸ì œ**: ë©€í‹°ë¼ì¸ ë¬¸ìì—´ì€ `@"..."@` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì„¸ìš”.
* **ë¬¸ì¥ì— ê³µë°± í¬í•¨ í† í°ì´ ê¹¨ì§**: ë‹¨ë§ì„ ë°˜ë“œì‹œ `"..."` ë¡œ ê°ì‹¸ì„¸ìš”.
* **ëë‚˜ì§€ ì•ŠëŠ” í™•ì¥/ë§¤ìš° ê¸´ ì‹œê°„**: ì¢Œì¬ê·€, ìˆœí™˜, ê³¼í•œ ë¶„ê¸°ë¥¼ ì˜ì‹¬í•˜ê³  ê°€ì¤‘ì¹˜/í•œê³„ë¥¼ ì¡°ì •í•˜ì„¸ìš”.
* **êµ¬ë‘ì  ì•ì— ê³µë°±ì´ ìƒê¹€**: êµ¬ë‘ì ì´ ë‹¨ì¼ í† í°ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. ì˜ˆ: `.` ë¥¼ ë‹¤ë¥¸ í† í°ê³¼ í•©ì¹˜ì§€ ë§ˆì„¸ìš”.

---

## ì„ë² ë”© ê°€ì´ë“œ (Embedding as a Library)

PoeticaëŠ” ëª¨ë“ˆë¡œ ì„í¬íŠ¸í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
from main import parse_grammar, expand

G = """
S -> hello , world .
"""

grammar = parse_grammar(G)
text, tree = expand(grammar, seed=42)
print(text)  # hello, world.
```

* **ë¶ˆë³€ì„±**: `Rule`/`Production` ì€ ë¶ˆë³€ì´ë¯€ë¡œ ìºì‹±/ê³µìœ ì— ì•ˆì „í•©ë‹ˆë‹¤.
* **íŠ¸ë¦¬ ê°€ê³µ**: `tree.to_dict()` ë¡œ ì§ë ¬í™”í•˜ì—¬ ì‹œê°í™”/í›„ì²˜ë¦¬ì— í™œìš©í•˜ì„¸ìš”.

---

## ë³´ì•ˆ ë° ì œì•½ (Security & Limitations)

* **íŒŒì¼/ë„¤íŠ¸ì›Œí¬ I/O ì—†ìŒ**: ì˜ë„ì¹˜ ì•Šì€ ë¶€ì‘ìš©ì´ ì—†ìŠµë‹ˆë‹¤.
* **ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì—†ìŒ**: DSLì€ ìˆœìˆ˜ ì„ ì–¸í˜•ì…ë‹ˆë‹¤.
* **ë¹ˆ ë¬¸ìì—´(Îµ) ì§ì ‘ í‘œê¸° ë¶ˆê°€**: `Optional` íŒ¨í„´ìœ¼ë¡œ ìš°íšŒ êµ¬í˜„ í•„ìš”.
* **ë§¤ìš° í° ë¬¸ë²•**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì»¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·œì¹™ì„ ëª¨ë“ˆí™”í•˜ê±°ë‚˜ ê°€ì¤‘ì¹˜ë¡œ íƒìƒ‰ì„ ì œí•œí•˜ì„¸ìš”.

---

## FAQ

**Q. ì™œ ê²°ê³¼ê°€ ë§¤ë²ˆ ê°™ë‚˜ìš”?**
A. `--seed` ê¸°ë³¸ê°’ ë•Œë¬¸ì— ê²°ì •ì ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ê²°ê³¼ê°€ í•„ìš”í•˜ë©´ ì‹œë“œë¥¼ ë³€ê²½í•˜ì„¸ìš”.

**Q. ì¢Œì¬ê·€ ë¬¸ë²•ì€ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?**
A. ì¢Œì¬ê·€ëŠ” ë¬´í•œ ì„±ì¥ì„ ìœ ë°œí•  ìˆ˜ ìˆìœ¼ë‹ˆ ìš°íšŒì „ê°œë¡œ ë³€í˜•í•˜ê±°ë‚˜ ì•ˆì „ í•œê³„ë¥¼ ì¡°ì •í•˜ì„¸ìš”.

**Q. JSON íŠ¸ë¦¬ êµ¬ì¡°ë¥¼ ë‹¤ë¥¸ ì–¸ì–´ì—ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ìš”.**
A. `--format json` ì¶œë ¥ì€ ë²”ìš©ì ì´ë¯€ë¡œ ì–´ë–¤ ì–¸ì–´ì—ì„œë„ íŒŒì‹±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Q. ëŒ€ì•ˆì— ê°€ì¤‘ì¹˜ë¥¼ ì£¼ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€?**
A. ë¹ˆë„ ë¹„ë¡€ë¡œ `*k` ë¥¼ ë¶€ì—¬í•˜ì„¸ìš”. ì˜ˆ: í”í•œ í‘œí˜„ì— `*5`, í¬ê·€ í‘œí˜„ì— `*1`.

---

## ë¼ì´ì„ ìŠ¤ (License)

MIT License. í•„ìš” ì‹œ ì¡°ì§ ì •ì±…ì— ë§ê²Œ êµì²´í•˜ì‹­ì‹œì˜¤.

---

# English Section

## Overview

**Poetica** is a singleâ€‘file, dependencyâ€‘free **weighted grammar expander**. It performs **leftmost derivation** with weighted alternatives and can output either a polished string or a full **JSON derivation tree**. All runs are deterministic via a seed and protected by explicit safety limits. Ideal for prompt/copy generation, test data, templated variations, and teaching CFG concepts.

## Features

* Mini DSL: `LHS -> alt1 | alt2 *3`, trailing `*k` for weights
* Deterministic by `--seed`
* JSON derivation tree via `--format json`
* Single file, stdlib only
* Builtâ€‘in fast tests: `python main.py --test`
* Safety limits: `--max-steps`, `--max-tokens`
* Smart punctuation joiner; robust `shlex` tokenization
* Clear domain errors: `GrammarError`, `GenerationLimitError`

## Quickstart

```bash
python main.py --help
python main.py --seed 1 --format text
```

If you see `Undefined nonterminals: Name`, pass a custom grammar via `--grammar` or add a `Name` rule. Use the **Recommended grammar** shown earlier.

## CLI Usage

```bash
python main.py [--seed SEED] [--start SYMBOL]
               [--max-steps N] [--max-tokens N]
               [--format {text,json}] [--verbose]
               [--grammar "<grammar text>"]
               [--test]
```

## Examples

```bash
# Deterministic text generation
python main.py --grammar "$G" --seed 1

# Full derivation tree
python main.py --grammar "$G" --format json

# Verbose expansion trace
python main.py --grammar "$G" --verbose

# Switch start symbol
python main.py --grammar "$G" --start NP --seed 3
```

Sample output:

```
the elegant code flows.
```

## Grammar DSL

* Rules: `LHS -> alt1 | alt2 | ...`
* Nonterminals: `UpperCamelCase`
* Terminals: everything else; quote multiâ€‘word tokens
* Weights: `*k` at the end of an alternative (k â‰¥ 1)
* Punctuation tokens are attached without leading spaces; `'s` is glued
* All referenced nonterminals must be defined at least once

### Quoting & Escapes

* Wrap tokens containing spaces/special characters with quotes, e.g., `"New York"`.
* Escapes follow Python `shlex` rules.

### Avoiding Left Recursion

Left recursion may cause runaway derivations. Prefer rightâ€‘factored or iterative forms. Poetica does not allow empty productions directly; model optionality via an explicit nonterminal.

## JSON Output Schema

See the KR section for a complete example. Nodes have `{label, children}`; terminals are `{terminal: str}`. The `text` field contains the final, neatly joined string.

## Determinism

Weighted choice uses integer arithmetic over a seeded `random.Random`, avoiding floatingâ€‘point drift. Identical inputs and parameters always yield identical outputs across platforms. Vary the seed to obtain new variations.

## Performance & Tuning

Time is `O(m * k)`; memory is `O(total_symbols)`. Increase `--max-steps`/`--max-tokens` for longer outputs; add weights to steer expansion; eliminate deep recursion when possible. Typical runs complete well under one second.

## Testing

```bash
python main.py --test
```

Includes doctests and unittests covering success, undefined symbols, and limit detection.

## Troubleshooting

* `Undefined nonterminals`: define all referenced nonterminals.
* Quoting issues on Windows: use PowerShell hereâ€‘strings (`@"..."@`).
* Spaces in tokens: quote them.
* Excessive growth: tune limits, refactor grammar, add weights.

## License

MIT.
